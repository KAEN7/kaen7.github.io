# ORM

## MVC

Model-View-Controllerì˜ ì•½ìë¡œì¨

ê°œë°œ í•  ë•Œ 3ê°€ì§€ í˜•íƒœë¡œ ì—­í• ì„ ë‚˜ëˆ„ì–´ ê°œë°œí•˜ëŠ” ë°©ë²•ë¡ 

`model` ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ `ë¬´ì—‡`ì„ í• ê²ƒì¸ì§€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
ì²˜ë¦¬ë˜ëŠ” ì•Œê³ ë¦¬ì¦˜, DBì™€ ìƒí˜¸ì‘ìš© ë°ì´í„° ë“±ë“±ì´ ìˆìŠµë‹ˆë‹¤

`controller`ëŠ” ëª¨ë¸ì´ `ì–´ë–»ê²Œ` ì²˜ë¦¬í• ì§€ë¥¼ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤
í™”ë©´ì˜ ë¡œì§ì²˜ë¦¬ ë¶€ë¶„ ê°™ì€ê²ƒì´ ìˆìŠµë‹ˆë‹¤

`view` ëŠ” modelì„ `í™”ë©´ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ”` ì—­í• ì„ í•©ë‹ˆë‹¤
ì›¹í˜ì´ì§€ë‚˜ ì–´í”Œì˜ í™”ë©´ ê°™ì€ ê²ƒì´ ìˆìŠµë‹ˆë‹¤

## ORM

ORMì€ ë°”ë¡œ Modelì„ ê¸°ìˆ í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì„¸ê³„ì™€ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ì‚¬ì´ì˜ ê°œë…ì˜ ê°„ê·¹ì„ ì¤„ì—¬ì¤ë‹ˆë‹¤.

ORMì„ í†µí•´ ê°ì²´ê°„ì˜ ê´€ê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ SQLì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•´ì¤ë‹ˆë‹¤

ê°ì²´ë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ë°ì´í„°ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤

> ORMì´ë€ ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë§¤í•‘(ì—°ê²°)í•´ì£¼ëŠ” ê²ƒì„ ë§í•œë‹¤. ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³ , ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” í…Œì´ë¸”ì„ ì‚¬ìš©í•œë‹¤.

### Sequelize

ì‹œí€„ë¼ì´ì¦ˆëŠ” nodejsì—ì„œ mysqlì„ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ,

ORM(Object-relational Mapping)ìœ¼ë¡œ ë¶„ë¥˜ëœë‹¤. sql ì‘ì„±ë²•ì„ ëª¨ë¥´ë”ë¼ë„ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

- **config**Â : sequelizeë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í™˜ê²½ì„ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.
- **models/index.js**Â : Modelì„ ì •ì˜í•˜ê³  ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.

### ì‹œí€„ë¼ì´ì¦ˆ index.js ëœ¯ì–´ë³´ê¸°

**models/index.js**

```jsx
// í™˜ê²½ë³€ìˆ˜, ì‹¤ì œ ë°°í¬í•  ë•ŒëŠ” 'production'ìœ¼ë¡œ ë°”ê¿”ì•¼í•œë‹¤.
const env = process.env.NODE_ENV || "development";
// config
const config = require(__dirname + "/../config/config.json")[env];
// db ê°ì²´ ìƒì„±
const db = {};
```

- ì°¸ê³ ë¡œ configíŒŒì¼ì—ëŠ” 'development', 'test', 'production' í‚¤ ê°’ì„ ê°€ì§„ ê°ê°ì˜ ì„¤ì •ë“¤ì´ ë‹´ê²¨ìˆë‹¤!

```jsx
let sequelize;
if (config.use_env_variable) {
  sequelize = new Sequelize(process.env[config.use_env_variable], config);
} else {
  sequelize = new Sequelize(
    config.database,
    config.username,
    config.password,
    config
  );
}
```

- ì‹œí€„ë¼ì´ì¦ˆ ê°ì²´ì— config íŒŒì¼ì— ìˆëŠ” ì„¤ì •ë“¤ì„ ë„£ì–´ì¤€ë‹¤.

```jsx
db.sequelize = sequelize;
db.Sequelize = Sequelize;

module.exports = db;
```

- db ê°ì²´ì— ì‹œí€„ë¼ì´ì¦ˆ íŒ¨í‚¤ì§€ì™€ ê°ì²´ë¥¼ ë„£ê³  ëª¨ë“ˆë¡œ ì‚¬ìš©í•œë‹¤.

## ì‹œí€„ë¼ì´ì¦ˆë¡œ database ë§Œë“¤ê¸°

ì‹œí€„ë¼ì´ì¦ˆë§Œ ìˆìœ¼ë©´ sqlë¬¸ ì‘ì„± ì—†ì´ë„! workbench ì—†ì´ë„!ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤.**ğŸ“ƒ config.js**

```
{
  "development": {
    "username": "root",
    "password": null,
    "database": "nodejs", // ìƒì„±í•˜ê³ ìí•˜ëŠ” databaseëª… ì ì–´ì£¼ê¸°
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  ...
```

ìš°ë¦¬ëŠ” í˜„ì¬ í™˜ê²½ë³€ìˆ˜ê°€ developmentì´ë‹ˆ ì—¬ê¸°ë¥¼ ê³ ì³ì¤€ë‹¤.ê·¸ë¦¬ê³  ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì— ë°‘ì˜ ëª…ë ¹ì–´ë¥¼ ì ì–´ì£¼ë©´ 'nodejs'ë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±ëœë‹¤.

```
$ sequelize db:create
```

---

## ğŸš© ì‹œí€„ë¼ì´ì¦ˆë¡œ table ì§œê¸°

ì•ìœ¼ë¡œ models í´ë” ë‚´ì—ì„œ js íŒŒì¼ë¡œ í…Œì´ë¸”ì„ ë§Œë“¤ ê²ƒì´ë‹¤.**ğŸ“ƒ ì‚¬ìš©ì í…Œì´ë¸”ê³¼ ëŒ“ê¸€ í…Œì´ë¸” ë§Œë“¤ê¸° ìœ„í•´ user.jsì™€ comment.js ìƒì„±**

```
const Sequelize = require('sequelize');

module.exports = ((sequelize,DataTypes)=>{
    return sequelize.define('user',{
        email:{
            type: Sequelize.STRING(40),
            allowNull: true,
            unique: true,
        },
        nick:{
            type: Sequelize.STRING(15),
            allowNull: false,
        },
        password:{
            type: Sequelize.STRING(100),
            allowNull: true, // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì€ ë¹„ë²ˆ í•„ìš”ì—†ìœ¼ë‹ˆ,,
        },
        prvider :{ // ë­ë¡œ ë¡œê·¸ì¸ í–ˆëŠ”ì§€ : ì¹´ì¹´ì˜¤, ë¡œì»¬,,
            type: Sequelize.STRING(10),
            allowNull: false,
            defaultValue: 'local',
        },
        snsId:{
            type: Sequelize.STRING(30),
            allowNull: true,
        },

    },{
        timestamps:true,
        paranoid : true, // ì‚­ì œì¼ (ë³µêµ¬ìš©)
    })
})
```

- **sequelize.define(ê°ì²´*ì´ë¦„, í…Œì´ë¸”*ì •ì˜, í…Œì´ë¸”\_ì„¤ì •)**
- ì°¸ê³ ë¡œ í…Œì´ë¸” ì„¤ì •ì—ëŠ”Â **tableName**ìœ¼ë¡œ í…Œì´ë¸” ì´ë¦„ ì„¤ì •ë„ ê°€ëŠ¥í•˜ë‹¤.

ê·¸ë¦¬ê³  index.jsì—ì„œ ë§Œë“  js íŒŒì¼ë“¤ì„ ë¶ˆëŸ¬ì˜¨ë‹¤.

```
db.User=require('./user')(sequelize,Sequelize);
db.Comment = require('./comment')(sequelize,Sequelize);
```

ë¶ˆëŸ¬ì˜¨ ë‹¤ìŒì— ë°”ë¡œ ì‹œí€„ë¼ì´ì¦ˆ ì¸ìŠ¤í„´ìŠ¤ì™€ íŒ¨í‚¤ì§€ë¥¼ ë„£ì–´ì¤¬ëŠ”ë° ì´ëŠ”

```
module.exports=(sequelize, DataTypes) =>{
```

ì—¬ê¸°ì˜ ë§¤ê°œë³€ìˆ˜ì™€ ì´ì–´ì§„ë‹¤.

---

## ğŸš© table ë‚´ìš© ì±„ìš°ê¸°

ì§€ê¸ˆê¹Œì§€ user, comment ë‘ ê°œì˜ í…Œì´ë¸”ì„ ë§Œë“¤ì—ˆë‹¤.ì´ì œ ì´ í…Œì´ë¸” ì•ˆì— ì†ì„±(column) ê°’ì„ ì±„ì›Œ ë„£ì–´ì•¼ í•œë‹¤.ì§šê³  ë„˜ì–´ê°ˆ ëª‡ê°€ì§€ ê°œë…ë§Œ ì •ë¦¬í•´ë³´ê² ë‹¤.

**ğŸ“ƒ user.js**

```
	name:{
            type:DataTypes.STRING(20),
            allowNull:false,
            unique: true,
        },
        creates_at:{
            type:DataTypes.DATE,
            allowNull:false,
            defaultValue:sequelize.literal('now()'),

        }
    },{
        timestamps:false,
        underscored:true,
    });
```

- type : ë°ì´í„°ì˜ íƒ€ì…ì„ ì ì–´ì¤€ë‹¤.
- allowNull : Null ê°’ì„ í—ˆìš©í•˜ëŠ”ì§€, ì•ˆí•˜ëŠ”ì§€ ì—¬ë¶€.
- unique : ê³ ìœ ì˜ ê°’ì„ ê°–ê²Œ í•˜ëŠ”ì§€.
- defaultValue : ê¸°ë³¸ê°’ ì„¤ì •ì´ë‹¤. ì—¬ê¸°ì„  ìƒì„± ë‚ ì§œë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ì‹œê°„ì„ ì €ì¥í•˜ë„ë¡ í•œë‹¤.
- timestamp : createdAtê³¼ updatedAt ì»¬ëŸ¼ì„ ìë™ ìƒì„±í•˜ê³  ì…ë ¥í•œë‹¤.
- underscored : '\_(ì–¸ë”ë°”)'ë¥¼ í—ˆìš©í• ê±´ì§€ ë§ê±´ì§€.

---

## ğŸš© ì‹œí€„ë¼ì´ì¦ˆ ê´€ê³„ ì„¤ì •í•˜ê¸°

comment í…Œì´ë¸”ì—ì„œ comment ì»¬ëŸ¼ì˜ ë‚´ë¶€ëŠ” ì ì–´ì£¼ì§€ ì•Šì•˜ë‹¤.ê·¸ ì´ìœ ëŠ” userê°€ ë°”ë¡œ commentë¥¼ ì‘ì„±í•œ ìê°€ ë˜ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œÂ **ê´€ê³„**ê°€ ìƒê¸°ëŠ” ê²ƒì´ë‹¤!

ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ê°œì˜ ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆê³ , ëŒ“ê¸€ í•˜ë‚˜ëŠ” í•œ ì‚¬ìš©ìì—ê²Œë§Œ ì†í•´ìˆë‹¤.ê·¸ëŸ¬ë¯€ë¡œ userì™€ commentëŠ” 1:Nì˜ ê´€ê³„ì´ë‹¤.ì´ëŠ” ì‹œí€„ë¼ì´ì¦ˆì—ì„œë„ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤.

```
db.User.hasMany(db.Comment, {foreignKey:'commeneter', sourceKey:'id'})
db.Comment.belongsTo(db.User,{foreignKey:'commeneter',targetKey:'id'})
```

- 1 : 1 ê´€ê³„ : (hasOne, belongsTo)
- 1 : N ê´€ê³„ : (haseMany, belongsTo)
- N : M ê´€ê³„ : (belongsToMany)

---

## ğŸš© ì‹œí€„ë¼ì´ì¦ˆë¡œ table ìƒì„±í•˜ê¸°

ì! ê·¸ëŸ¼ ì´ì œ í…Œì´ë¸”ì´ ë§Œë“¤ì–´ì¡Œë‚˜?ğŸ‘€ì•„ë‹ˆë‹¤.í…Œì´ë¸”ì˜ êµ¬ì¡°ë¥¼ ì§°ì„ ë¿, í…Œì´ë¸”ì€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ë‹¤.í…Œì´ë¸”ì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„  app.jsë¥¼ ê±´ë“¤ì—¬ì¤˜ì•¼í•œë‹¤.ì„œë²„ê°€ ìš°ì£¼ì„ ğŸš€ì´ë¼ê³  í•œë‹¤ë©´,app.js ìš°ì£¼ì„ ì˜ ì¤‘ì•™ í†µì œì‹¤ğŸš¨ì´ë‹¤.ìš°ë¦¬ê°€ ì§€ê¸ˆê¹Œì§€ ì‘ì—…í•œ db ëª¨ë“ˆì€ ë‹¨ì§€ ìš°ì£¼ì„ ì˜ ë¶€í’ˆğŸ§±ì¼ ë¿..ì´ì œ ì¡°ë¦½ì„ í•  ì°¨ë¡€ì´ë‹¤!

**ğŸ“ƒ app.js**

```
var {sequelize} = require('../models/index')

var app = express();
sequelize.sync();
```

ì´ë ‡ê²Œ í•˜ë©´ ì„œë²„ê°€ ì‹¤í–‰ë  ë•Œ í…Œì´ë¸”ì´ ìƒì„±ëœë‹¤.ê·¸ ì „ì— config.jsì— development í™˜ê²½ë³€ìˆ˜ì—

```
"operatorAliases":false
```

ë¥¼ ì¶”ê°€í•´ì¤˜ì•¼ì§€ ì—ëŸ¬ê°€ ì•ˆë‚œë‹¤ê³  í•œë‹¤.

[Sequelize](https://sequelize.org/master/manual/migrations.html)

ëª…ë ¹ì–´ë° ì„¤ì¹˜ë°©ë²•ì´ ë‹´ê²¨ìˆëŠ” ê³µì‹ë¬¸ì„œ

## ì°¸ì¡°

[[ì•„í‚¤í…ì²˜ íŒ¨í„´] MVC íŒ¨í„´ì´ë€?](https://medium.com/@jang.wangsu/%EB%94%94%EC%9E%90%EC%9D%B8%ED%8C%A8%ED%84%B4-mvc-%ED%8C%A8%ED%84%B4%EC%9D%B4%EB%9E%80-1d74fac6e256)

[https://github.com/byungju0624/im-sprint-shortly-mvc/blob/master/controllers/links/index.js](https://github.com/byungju0624/im-sprint-shortly-mvc/blob/master/controllers/links/index.js)

[Sequelize ì‚¬ìš©ë²•](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=dilrong&logNo=221374306867)

ë©”ì†Œë“œ ì´ë¦„ê°™ì€ê²ƒë“¤ ì •ë¦¬ì˜ë˜ìˆìŒ

[[Node.js] #8 MySQLê³¼ Sequelize](https://velog.io/@new_wisdom/Node.js-7-MySQL%EA%B3%BC-Sequelize)

sequelize ê¸°ì´ˆ ì„¤ëª… ì˜ë˜ì–´ìˆìŒ
